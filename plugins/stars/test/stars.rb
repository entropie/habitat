require File.dirname(__FILE__) + "/../../../lib/habitat"
require File.dirname(__FILE__) + "/../../../test/test"

require File.dirname(__FILE__) + "/../lib/stars"

require "minitest/autorun" if __FILE__ == $0

Habitat.add_adapter(:stars, Stars::Database.with_adapter.new(TMP_PATH))


def _clr
  FileUtils.rm_rf(TMP_PATH, :verbose => true)
end

def adapter
  Habitat.adapter(:stars)
end

def img
  "data:image/jpeg;base64,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"
end

def create_michis
  adapter.create("michi trommer", 5, "Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.", img)
end

class TestStars < Minitest::Test

  include Stars
  
  def setup
    _clr
    FileUtils.mkdir_p(File.join(TMP_PATH, "stars"))
  end

  def test_michis
    create_michis
  end

  def test_foobars
    create_michis
    assert_raises ::Stars::StarAlreadyExist do
      create_michis
    end
  end

  def test_stars
    create_michis
    assert_equal adapter.stars.size, 1
  end

  def test_get_michis
    create_michis
    assert_equal adapter.stars["michi trommer"].ident, "michi-trommer"
  end

  def test_remove_michis
    create_michis
    adapter.stars["michi trommer"].destroy
    assert_equal adapter.stars.size, 0
  end
end
